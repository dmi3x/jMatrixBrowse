(function(c){function a(a){if("string"===typeof a.data){var g=a.handler,d=a.data.toLowerCase().split(" ");a.handler=function(a){if(!(this!==a.target&&(/textarea|select/i.test(a.target.nodeName)||"text"===a.target.type))){var j="keypress"!==a.type&&c.hotkeys.specialKeys[a.which],i=String.fromCharCode(a.which).toLowerCase(),h="",n={};a.altKey&&"alt"!==j&&(h+="alt+");a.ctrlKey&&"ctrl"!==j&&(h+="ctrl+");a.metaKey&&(!a.ctrlKey&&"meta"!==j)&&(h+="meta+");a.shiftKey&&"shift"!==j&&(h+="shift+");j?n[h+j]=
!0:(n[h+i]=!0,n[h+c.hotkeys.shiftNums[i]]=!0,"shift+"===h&&(n[c.hotkeys.shiftNums[i]]=!0));j=0;for(i=d.length;j<i;j++)if(n[d[j]])return g.apply(this,arguments)}}}}c.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",
109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(","0":")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}};c.each(["keydown","keyup","keypress"],function(){c.event.special[this]={add:a}})})(jQuery);(function(c){function a(a){var e=a||window.event,j=[].slice.call(arguments,1),i=0,h=0,n=0,a=c.event.fix(e);a.type="mousewheel";e.wheelDelta&&(i=e.wheelDelta/120);e.detail&&(i=-e.detail/3);n=i;void 0!==e.axis&&e.axis===e.HORIZONTAL_AXIS&&(n=0,h=-1*i);void 0!==e.wheelDeltaY&&(n=e.wheelDeltaY/120);void 0!==e.wheelDeltaX&&(h=-1*e.wheelDeltaX/120);j.unshift(a,i,h,n);return(c.event.dispatch||c.event.handle).apply(this,j)}var i=["DOMMouseScroll","mousewheel"];if(c.event.fixHooks)for(var g=i.length;g;)c.event.fixHooks[i[--g]]=
c.event.mouseHooks;c.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var c=i.length;c;)this.addEventListener(i[--c],a,!1);else this.onmousewheel=a},teardown:function(){if(this.removeEventListener)for(var c=i.length;c;)this.removeEventListener(i[--c],a,!1);else this.onmousewheel=null}};c.fn.extend({mousewheel:function(c){return c?this.bind("mousewheel",c):this.trigger("mousewheel")},unmousewheel:function(c){return this.unbind("mousewheel",c)}})})(jQuery);var jMatrixBrowseNs=jMatrixBrowseNs||{};
jMatrixBrowseNs.Constants={OVERFLOW_LEFT:1,OVERFLOW_RIGHT:2,OVERFLOW_TOP:3,OVERFLOW_BOTTOM:4,OVERFLOW_NONE:-1,CLASS_BASE:"jmatrixbrowse",N_BACKGROUND_CELLS:1,DEFAULT_OPTIONS:{str_initialWindowPosition:"0,0",str_initialWindowSize:"10,10",boo_snap:!1,boo_animate:!1,minVelocityForAnimation:4,animationDuration:2E3,str_api:"test"},DEFAULT_DATA_RELOAD_STRATEGY:1,RELOAD_HTML_REPLACEMENT:1,RELOAD_CELL_REPLACEMENT:2,RELOAD_CELL_POSITION:3,BACKGROUND_DATA_RELOAD_DELAY:2E3,ZOOM_LEVEL_DIFFERENCE:2,ZOOM_MAX_WINDOW_SIZE:{height:10,
width:20}};jMatrixBrowseNs=jMatrixBrowseNs||{};
(function(c,a){a.Configuration=function(i){var g=a.Constants.DEFAULT_DATA_RELOAD_STRATEGY;var d={boo_jMatrixBrowser:"true"===i.attr("data-jmatrix_browser"),str_api:i.attr("data-api"),str_initialWindowSize:i.attr("data-initial-window-size"),str_initialWindowPosition:i.attr("data-initial-window-position"),boo_snap:"true"===i.attr("data-snap"),boo_animate:"true"===i.attr("data-animate"),animationDuration:i.attr("data-deceleration-duration"),minVelocityForAnimation:i.attr("data-min-velocity-for-animation")};i.attr("data-animate");
if(!0!==d.boo_jMatrixBrowser&&!0!==d.boo_jMatrixBrowser)throw"data-jmatrix_browser invalid";if(d.str_initialWindowSize&&!/\s*\d+\s*,\s*\d+\s*/.test(d.str_initialWindowSize))throw"data-initial-window-size invalid.";if(d.str_initialWindowPosition&&!/\s*\d+\s*,\s*\d+\s*/.test(d.str_initialWindowPosition))throw"data-initial-window-size invalid.";var e=c.extend(a.Constants.DEFAULT_OPTIONS,d);this.getSettings=function(){return e};this.getWindowSize=function(){if(e&&e.str_initialWindowSize){var c=a.Utils.parsePosition(e.str_initialWindowSize);
return{height:c.row,width:c.col}}return null};this.setWindowSize=function(c){e.str_initialWindowSize=c.height+","+c.width};this.getWindowPosition=function(){return e&&e.str_initialWindowPosition?a.Utils.parsePosition(e.str_initialWindowPosition):null};this.getApiUrl=function(){return e.str_api};this.getNumberOfBackgroundCells=function(){return a.Constants.N_BACKGROUND_CELLS};this.getDataReloadStrategy=function(){return g};this.isSnapEnabled=function(){return e.boo_snap};this.getAnimationDuration=
function(){return e.animationDuration};this.getMinVelocityForAnimation=function(){return e.minVelocityForAnimation};this.animateEnabled=function(){return e.boo_animate};return this}})(jQuery,jMatrixBrowseNs);jMatrixBrowseNs=jMatrixBrowseNs||{};
(function(c,a){a.jMatrixBrowseRenderer=function(i,g,d){var e,j;function r(s){x.setRenderer(k);var b=u,w=c(document.createElement("div"));w.css({width:"90%",height:"10%",top:"0px",right:"0px","background-color":"red",position:"absolute",overflow:"hidden"});w.addClass(a.Constants.CLASS_BASE+"-col-header");b.append(w);var h=c(document.createElement("div"));h.css({width:"10%",height:"90%",bottom:"0px","background-color":"green","float":"left",position:"absolute",overflow:"hidden"});h.addClass(a.Constants.CLASS_BASE+
"-row-header");b.append(h);z={row:h,col:w};b=u;w=c(document.createElement("div"));w.css({"float":"left",width:"90%",height:"90%",bottom:"0px",right:"0px",position:"absolute",overflow:"hidden"});w.addClass(a.Constants.CLASS_BASE+"-drag-container-container");b.append(w);var i=c(document.createElement("div"));i.draggable({drag:function(c,b){c.type="jMatrixBrowseDrag";u.trigger(c);y.push({position:b.position,timestamp:(new Date).getTime()});60<y.length&&y.splice(0,30)},start:function(c){D?(C.stop(),E=
!0,D=!1):E=!1;c.type="jMatrixBrowseDragStart";u.trigger(c)},stop:function(b){var f=(new Date).getTime();if(q.animateEnabled()){var s=y.length-1;if(1E3>f-y[s].timestamp){for(var a=f=s;0<a&&y[a].timestamp>y[s].timestamp-100;--a)f=a;if(f!==s&&(a=y[s].timestamp-y[f].timestamp,e=(y[s].position.left-y[f].position.left)/a,j=(y[s].position.top-y[f].position.top)/a,e=Math.abs(e)<q.getMinVelocityForAnimation()?0:e,j=Math.abs(j)<q.getMinVelocityForAnimation()?0:j,0<Math.abs(e)||0<Math.abs(j)))s=q.getAnimationDuration(),
E&&(j*=2,e*=2),C.animate({top:"+="+j*s,left:"+="+e*s},{duration:s,easing:!E?"easeOutCubic":"easeInOutCubic",step:function(c,f){u.trigger({type:"jMatrixBrowseAnimationStep",now:c,fx:f})},complete:function(){D=false;var f=n(c(this).position(),{top:0,left:0},C.draggable().data("draggable"));C.animate(f,{duration:"fast",complete:function(){u.trigger({type:"jMatrixBrowseAnimationComplete"})}})}}),D=!0}}b.type="jMatrixBrowseDragStop";u.trigger(b)},containment:[0,0,2E3,2E3]});i.draggable().data("draggable")._generatePosition=
function(f){var b=i.draggable().data("draggable"),s="absolute"==b.cssPosition&&!(b.scrollParent[0]!=document&&$.ui.contains(b.scrollParent[0],b.offsetParent[0]))?b.offsetParent:b.scrollParent,a=/(html|body)/i.test(s[0].tagName),k=f.pageX,f={top:f.pageY-b.offset.click.top-b.offset.relative.top-b.offset.parent.top+(c.browser.safari&&526>c.browser.version&&"fixed"==b.cssPosition?0:"fixed"==b.cssPosition?-b.scrollParent.scrollTop():a?0:s.scrollTop()),left:k-b.offset.click.left-b.offset.relative.left-
b.offset.parent.left+(c.browser.safari&&526>c.browser.version&&"fixed"==b.cssPosition?0:"fixed"==b.cssPosition?-b.scrollParent.scrollLeft():a?0:s.scrollLeft())},s={top:b._convertPositionTo("absolute",f).top-b.positionAbs.top,left:b._convertPositionTo("absolute",f).left-b.positionAbs.left};return n(f,s,b)};i.addClass(a.Constants.CLASS_BASE+"-drag-container");w.append(i);C=i;A=w;b=s.row;s=s.col;_cellPosition=c("."+("j-matrix-browse-cell-row"+b+"col"+s)).position();t.currentCell={row:b,col:s};b=C;if(void 0==
x.getMatrixSize())console.error("Unable to get matrix size"),_content=null;else{var d=q.getWindowSize();if(void 0==d)console.error("Unable to get window size"),_content=null;else{s=c(document.createElement("div")).addClass("jMatrixBrowse-content");b.append(s);s.css({position:"absolute",top:0,left:0});var b=A.height()/d.height,w=A.width()/d.width,g=q.getWindowPosition();f=[];for(var h=d.height+2*q.getNumberOfBackgroundCells(),d=d.width+2*q.getNumberOfBackgroundCells(),l=Math.max(0,g.row-q.getNumberOfBackgroundCells()),
g=Math.max(0,g.col-q.getNumberOfBackgroundCells()),p=document.createDocumentFragment(),r=l;r<l+h;r++){f.push([]);for(var o=g;o<g+d;o++){var m=document.createElement("div");m.style.backgroundColor=0<r%2+o%2?"#ddd":"whitesmoke";m.style.width=w+"px";m.style.height=b+"px";m.style.position="absolute";m.style.top=(r-l-q.getNumberOfBackgroundCells())*b+"px";m.style.left=(o-g-q.getNumberOfBackgroundCells())*w+"px";m.style.display="inline-block";m.style.textIndent="6px";m.innerHTML=r+","+o;m.className+=" jMatrixBrowse-cell "+
("j-matrix-browse-cell-row"+r+"col"+o);c(m).attr("data-row",r);c(m).attr("data-col",o);p.appendChild(m);f[r-l].push(m)}}s.append(p);u.find(".jMatrixBrowse-cell").click(function(b){if(F)F=!1;else{var f=c(this);b.type="jMatrixBrowseClick";b.row=f.attr("data-row");b.col=f.attr("data-col");u.trigger(b)}});_content=s}}s=z;b=s.row;w=x.getRowHeadersFromTopRow(t.currentCell.row-q.getNumberOfBackgroundCells());h=document.createDocumentFragment();d=0;for(l=w.length;d<l;++d)p=c(f[d][0]),g=c(document.createElement("div")),
g.addClass(a.Constants.CLASS_BASE+"-row-header-cell"),p={width:"100%",height:p.height(),top:p.position().top,left:0,position:"absolute"},g.css(p),g.html(w[d]),h.appendChild(g[0]);b.append(h);s=s.col;b=x.getColHeadersFromLeftCol(t.currentCell.col-q.getNumberOfBackgroundCells());w=document.createDocumentFragment();h=0;for(d=b.length;h<d;++h)g=c(f[0][h]),l=c(document.createElement("div")),l.addClass(a.Constants.CLASS_BASE+"-col-header-cell"),g={width:g.width(),height:"100%",left:g.position().left,top:0,
position:"absolute"},l.css(g),l.html(b[h]),w.appendChild(l[0]);s.append(w);u.trigger("jMatrixBrowseRendererInitialized")}function h(){z.row.remove();z.col.remove();C.remove();A.remove()}function n(b,a){var k=c(f[0==t.currentCell.row?1:0][0==t.currentCell.col?1:0]),h=A.offset(),d=k.offset();1>=t.currentCell.row&&(k=a.top+d.top-h.top,0<k&&(b.top-=k));1>=t.currentCell.col&&(d=a.left+d.left-h.left,0<d&&(b.left-=d));k=c(f[f.length-1][f[0].length-1]);d=k.offset();if(t.currentCell.row-q.getNumberOfBackgroundCells()+
f.length-1>=x.getMatrixSize().height-1){var j=h.top+A.height(),e=a.top+d.top+k.height(),j=j-e;0<j&&(b.top+=j)}t.currentCell.col-q.getNumberOfBackgroundCells()+f[0].length-1>=x.getMatrixSize().width-1&&(h=h.left+A.width(),d=a.left+d.left+k.width(),h-=d,0<h&&(b.left+=h));return b}function p(b){var c=x.getMatrixSize();return"up"===b&&1>t.currentCell.row||"down"===b&&t.currentCell.row-q.getNumberOfBackgroundCells()+f.length-1>c.height-1||"right"===b&&t.currentCell.col-q.getNumberOfBackgroundCells()+f[0].length-
1>c.width-1||"left"===b&&1>t.currentCell.col?!1:!0}function o(){for(var b=2*q.getNumberOfBackgroundCells()+1,k=2*q.getNumberOfBackgroundCells()+1,h=[],d=[],j=A.offset(),e=0;e<b&&e<f.length;++e)for(var i=0;i<k&&i<f[e].length;++i){var g=c(f[e][i]).offset();d.push((g.top-j.top)*(g.top-j.top)+(g.left-j.left)*(g.left-j.left));h.push(c(f[e][i]))}return h[a.Utils.findIndexOfMin(d).minIndex]}function b(b){var c=q.getWindowSize().height;if("up"===b){if(b=t.currentCell.row-c,1>b)return Math.max(0,c+b)}else{var b=
x.getMatrixSize().height,a=t.currentCell.row+c+f.length-q.getNumberOfBackgroundCells()-1;if(a>=b-1)return Math.max(0,c-(a-b))}return c}function l(b){var c=q.getWindowSize().width;if("left"===b){if(b=t.currentCell.col-c,0>b)return Math.max(0,c+b)}else{var b=x.getMatrixSize().width,a=t.currentCell.col+c+f[0].length-q.getNumberOfBackgroundCells()-1;if(a>=b)return Math.max(0,c-(a-b))}return c}function m(b,a){if(0!==a){var h=c.extend({},t.currentCell);if("up"===b)for(var d=0;d<a;++d){var j=f.length-1;
k.moveRowToTop(j);--t.currentCell.row}else for(d=0;d<a;++d)j=0,k.moveRowToEnd(j),++t.currentCell.row;d=0;for(j=f.length;d<j;++d)for(var e=0,i=f[d].length;e<i;++e){var g=c(f[d][e]);g.css({top:g.position().top+("up"===b?a:-a)*g.height()})}d=t.currentCell;z.row.children().each(function(b,a){var k=A.offset(),k=c(f[b][0]).offset().top-k.top;c(a).css({top:k})});u.trigger({type:"jMatrixBrowseChange",previousCell:h,currentCell:d,direction:"down"===b?"top":"bottom"})}}function B(b,a){if(0!==a){var h=c.extend({},
t.currentCell);if("left"===b)for(var d=0;d<a;++d){var j=f[0].length-1;k.moveColToLeft(j);--t.currentCell.col}else for(d=0;d<a;++d)j=0,k.moveColToRight(j),++t.currentCell.col;d=0;for(j=f.length;d<j;++d)for(var e=0,i=f[d].length;e<i;++e){var g=c(f[d][e]);g.css({left:g.position().left+("left"===b?a:-a)*g.width()})}d=t.currentCell;z.col.children().each(function(b,a){var k=A.offset(),k=c(f[0][b]).offset().left-k.left;c(a).css({left:k})});u.trigger({type:"jMatrixBrowseChange",previousCell:h,currentCell:d,
direction:"left"===b?"right":"left"})}}function v(b,a){for(var k=b.row1;k<=b.row2;++k)for(var d=a.col1;d<=a.col2;++d)c(f[k][d]).html('<div class="jMatrixBrowse-loading"/>')}var k=this,C,f,z,u,q,x,t,F=!1,A,y=[],D=!1,E=!1;t=k;u=i;q=g;x=d;i.addClass("jmb-matrix-container");this.getCellElements=function(){return f};this.getHeaders=function(){return z};this.getContainer=function(){return A};this.moveRowToEnd=function(b){var a=f.length,a=0<f[a-1].length?c(f[a-1][0]):void 0;if(void 0===a)return console.error("Unable to move row "+
b+" to the end."),!1;for(var a=a.position().top+a.height(),k=0,d=f[b].length;k<d;++k)c(f[b][k]).css({top:a});b=f.splice(b,1);0<b.length&&f.push(b[0]);v({row1:f.length-1,row2:f.length-1},{col1:0,col2:f[0].length-1});return!0};this.moveRowToTop=function(b){var a=0<f.length&&0<f[0].length?c(f[0][0]):void 0;if(void 0===a)return console.error("Unable to move row "+b+" to top."),!1;for(var a=a.position().top,k=0,d=f[b].length;k<d;++k)c(f[b][k]).css({top:a-c(f[b][k]).height()});b=f.splice(b,1);0<b.length&&
f.splice(0,0,b[0]);v({row1:0,row2:0},{col1:0,col2:f[0].length-1});return!0};this.moveColToRight=function(b){if(0>=f.length||0>=f[0].length)return console.error("Unable to move col "+b+" to right."),!1;for(var a=c(f[0][f[0].length-1]),k=a.position().left+a.width(),a=0,d=f.length;a<d;++a)c(f[a][b]).css({left:k});a=0;for(d=f.length;a<d;++a)k=f[a].splice(b,1),f[a].push(k[0]);v({row1:0,row2:f.length-1},{col1:f[0].length-1,col2:f[0].length-1});return!0};this.moveColToLeft=function(b){if(0>=f.length||0>=
f[0].length)return console.error("Unable to move col "+b+" to left."),!1;for(var a=c(f[0][0]).position().left,k=0,d=f.length;k<d;++k)c(f[k][b]).css({left:a-c(f[k][b]).width()});k=0;for(d=f.length;k<d;++k)a=f[k].splice(b,1),f[k].splice(0,0,a[0]);v({row1:0,row2:f.length-1},{col1:0,col2:0});return!0};this.scrollRight=function(){p("right")&&B("right",1)};this.scrollLeft=function(){p("left")&&B("left",1)};this.scrollUp=function(){p("up")&&m("up",1)};this.scrollDown=function(){p("down")&&m("down",1)};this.pageUp=
function(){var a=b("up");m("up",a)};this.pageDown=function(){var a=b("down");m("down",a)};this.pageLeft=function(){var b=l("left");B("left",b)};this.pageRight=function(){var b=l("right");B("right",b)};this.snapToGrid=function(b,a){if(void 0===b&&void 0===a)t.snapToGrid(o());else{var c=A.offset(),k=b.offset(),f=C.offset();if("top"===a||void 0===a){var d=k.top-c.top;0!==d&&(f.top-=d)}if("left"===a||void 0===a)c=k.left-c.left,0!==c&&(f.left-=c);C.offset(f)}};this.zoomIn=function(){var b=q.getWindowSize();
q.setWindowSize({height:Math.max(1,b.height-a.Constants.ZOOM_LEVEL_DIFFERENCE),width:Math.max(1,b.width-a.Constants.ZOOM_LEVEL_DIFFERENCE)});h();r(t.currentCell)};this.zoomOut=function(){var b=q.getWindowSize(),b={height:Math.min(a.Constants.ZOOM_MAX_WINDOW_SIZE.height,x.getMatrixSize().height,b.height+a.Constants.ZOOM_LEVEL_DIFFERENCE),width:Math.min(a.Constants.ZOOM_MAX_WINDOW_SIZE.width,x.getMatrixSize().width,b.width+a.Constants.ZOOM_LEVEL_DIFFERENCE)};q.setWindowSize(b);var c=x.getMatrixSize(),
k=t.currentCell,k={row:k.row+b.height>c.height?c.height-b.height:k.row,col:k.col+b.width>c.width?c.width-b.width:k.col};h();r(k)};this.getIsAnimating=function(){return D};r(q.getWindowPosition());return k}})(jQuery,jMatrixBrowseNs);jMatrixBrowseNs=jMatrixBrowseNs||{};
(function(c,a){a.BackgroundDataManager=function(i,g,d){var e,j={row1:0,col1:0,row2:0,col2:0};e=c("<div/>",{className:"jMatrixBrowse-background-data-container"}).appendTo(i);(function h(n){setTimeout(function(){g.getResponseDataAsync(n,function(p){for(var o=0;o<p.length;++o)for(var b=0;b<p[o].length;++b){var l=c("<div/>",{className:"jMatrixBrowse-background-cell","data-row":o+n.row1,"data-col":b+n.col1,html:p[o][b]});d.getDataReloadStrategy===a.Constants.RELOAD_CELL_POSITION?(i.find(".jMatrixBrowse-content").append(l),
l.hide()):e.append(l)}j.row2=n.row2;j.col2=n.col2;p=g.getMatrixSize();if(n.row2<p.height-1)n.row1=Math.min(n.row1+20+1,p.height-1),n.row2=Math.min(n.row2+20+1,p.height-1);else if(n.row1=0,n.row2=20,n.col2<p.width-1)n.col1=Math.min(n.col1+20+1,p.width-1),n.col2=Math.min(n.col2+20+1,p.width-1);else{i.trigger({type:"jMatrixBrowseLoadComplete"});return}h(n)})},a.Constants.BACKGROUND_DATA_RELOAD_DELAY)})({row1:0,row2:20,col1:0,col2:20});this.getCellsForRequest=function(h,j){for(var e=[],o=!1,b=h.col1;b<=
h.col2;++b){for(var l=h.row1;l<=h.row2;++l)if(0==i.find(".jMatrixBrowse-background-cell[data-row="+l+"][data-col="+b+"]").length){e.push({row1:l,col1:b,row2:h.row2,col2:h.col2});o=!0;break}if(o)break}o&&l>h.row1&&(l<h.row2&&b>h.col1&&b<h.col2)&&e.push({row1:h.row1,col1:b+1,row2:l-1,col2:h.col2});if(0<e.length)for(var m=e.length,B=Array(m),o=e.length-1;0<=o;o--)(function(b){g.getResponseDataAsync(e[b],function(k){B[b]=k;--m;if(0==m){for(var k=Array(h.row2-h.row1+1),g=k.length-1;0<=g;g--)k[g]=Array(h.col2-
h.col1+1);for(g=B.length-1;0<=g;--g)for(var f=B[g],z=e[g],u=f.length-1;0<=u;--u)for(var q=f[u].length-1;0<=q;--q){var l=c("<div/>",{className:"jMatrixBrowse-background-cell","data-row":u+z.row1,"data-col":q+z.col1,html:f[u][q]});d.getDataReloadStrategy===a.Constants.RELOAD_CELL_POSITION&&(i.find(".jMatrixBrowse-content").append(l),l.hide());k[u+z.row1-h.row1][q+z.col1-h.col1]=l}for(u=h.col1;u<=e[0].col1;++u)for(g=h.row1;g<=h.row2&&!(u==e[0].col1&&g>=e[0].row1);++g)k[g-h.row1][u-h.col1]=i.find(".jMatrixBrowse-background-cell[data-row="+
g+"][data-col="+u+"]");j.call(this,k)}})})(o);else{b=[];for(o=h.row1;o<=h.row2;++o){b.push([]);for(l=h.col1;l<=h.col2;++l)b[o-h.row1].push(i.find(".jMatrixBrowse-background-cell[data-row="+o+"][data-col="+l+"]"))}j.call(this,b)}};this.getWindowLoaded=function(){return j};return this}})(jQuery,jMatrixBrowseNs);jMatrixBrowseNs=jMatrixBrowseNs||{};
(function(c,a){c.fn.jMatrixBrowse=function(){function i(c){switch(c){case a.Constants.OVERFLOW_TOP:++b.currentCell.row;break;case a.Constants.OVERFLOW_BOTTOM:--b.currentCell.row;break;case a.Constants.OVERFLOW_LEFT:++b.currentCell.col;break;case a.Constants.OVERFLOW_RIGHT:--b.currentCell.col}}function g(c){switch(c){case a.Constants.OVERFLOW_TOP:return b.currentCell.row-l.getNumberOfBackgroundCells()+b.getCellElements().length-1>=m.getMatrixSize().height-1?!1:!0;case a.Constants.OVERFLOW_BOTTOM:return b.currentCell.row<=
0+l.getNumberOfBackgroundCells()?!1:!0;case a.Constants.OVERFLOW_LEFT:return b.currentCell.col-l.getNumberOfBackgroundCells()+b.getCellElements()[0].length-1>=m.getMatrixSize().width-1?!1:!0;case a.Constants.OVERFLOW_RIGHT:return b.currentCell.col<=0+l.getNumberOfBackgroundCells()?!1:!0}}function d(){var c;c=j(b.getCellElements(),b.getContainer(),1,a.Constants.OVERFLOW_TOP)||!1;c=j(b.getCellElements(),b.getContainer(),b.getCellElements().length-2,a.Constants.OVERFLOW_BOTTOM)||c;c=r(b.getCellElements(),
b.getContainer(),1,a.Constants.OVERFLOW_LEFT)||c;if(c=r(b.getCellElements(),b.getContainer(),b.getCellElements()[0].length-2,a.Constants.OVERFLOW_RIGHT)||c)d(),e()}function e(){b.getHeaders().row.children().each(function(a,d){var f=b.getContainer().offset(),f=c(b.getCellElements()[a][0]).offset().top-f.top;c(d).css({top:f})});b.getHeaders().col.children().each(function(a,d){var f=b.getContainer().offset(),f=c(b.getCellElements()[0][a]).offset().left-f.left;c(d).css({left:f})})}function j(k,d,f,h){if(0<
k[f].length&&a.Utils.isOverflowing(c(k[f][0]),d,h)&&g(h)){d=c.extend({},b.currentCell);i(h);var e;switch(h){case a.Constants.OVERFLOW_TOP:e="top";if(!1===b.moveRowToEnd(0))return!1;break;case a.Constants.OVERFLOW_BOTTOM:if(e="bottom",!1===b.moveRowToTop(k.length-1))return!1}v.trigger({type:"jMatrixBrowseChange",previousCell:d,currentCell:b.currentCell,direction:e});return!0}return!1}function r(k,d,f,h){if(a.Utils.isOverflowing(c(k[0][f]),d,h)&&g(h)){d=c.extend({},b.currentCell);i(h);var e;switch(h){case a.Constants.OVERFLOW_LEFT:e=
"left";if(!1===b.moveColToRight(0))return!1;break;case a.Constants.OVERFLOW_RIGHT:if(e="right",!1===b.moveColToLeft(k[0].length-1))return!1}v.trigger({type:"jMatrixBrowseChange",previousCell:d,currentCell:b.currentCell,direction:e});return!0}return!1}function h(a,c){var f=0,d,e=Math.abs(a.currentCell.row-a.previousCell.row),j=a.currentCell.row-l.getNumberOfBackgroundCells(),g=a.currentCell.row-l.getNumberOfBackgroundCells()+b.getCellElements().length-1;if("top"===c){g>=m.getMatrixSize().height&&(f=
g-m.getMatrixSize().height+1);if(f===e)return-1;d={row1:g-(e-1),row2:g-f}}else if("bottom"===c){0>j&&(f=-j);if(f===e)return-1;d={row1:j+f,row2:j+(e-1)}}else"both"===c&&(d=h(a,"top"),e=h(a,"bottom"),-1===d&&(d={row2:g}),-1===e&&(e={row1:j}),d={row1:e.row1,row2:d.row2});d.rowsNotInBound=f;return d}function n(a,c){var d=0,h,e=Math.abs(a.currentCell.col-a.previousCell.col),j=a.currentCell.col-l.getNumberOfBackgroundCells(),g=a.currentCell.col-l.getNumberOfBackgroundCells()+b.getCellElements()[0].length-
1;if("left"===c){if(g>=m.getMatrixSize().width&&(d=g-m.getMatrixSize().width+1,d===e))return-1;h={col1:g-(e-1),col2:g}}else if("right"===c){if(0>j&&(d=-j,d===e))return-1;h={col1:j+d,col2:j+(e-1)}}else"both"===c&&(h=n(a,"left"),e=n(a,"right"),-1===h&&(h={col2:g}),-1===e&&(e={col1:j}),h={col1:e.col1,col2:h.col2});h.colsNotInBound=d;return h}function p(d,h,f){for(var e=d.row1;e<=d.row2;++e){var j=e-b.currentCell.row+l.getNumberOfBackgroundCells();if(!(0>j||j>=b.getCellElements().length))for(var g=b.getCellElements()[j],
i=h.col1;i<=h.col2;++i){var n=i-b.currentCell.col+l.getNumberOfBackgroundCells();if(!(0>n||n>=g.length)){var r=c(g[n]),o=j,p=n,m=f[e-d.row1][i-h.col1],n=e,v=i;l.getDataReloadStrategy()===a.Constants.RELOAD_CELL_REPLACEMENT?(m=m.clone().removeClass("jMatrixBrowse-background-cell").addClass("jMatrixBrowse-cell").css({width:r.css("width"),height:r.css("height"),top:r.css("top"),left:r.css("left"),position:"absolute"}),r.replaceWith(m),b.getCellElements()[o][p]=m):l.getDataReloadStrategy()===a.Constants.RELOAD_HTML_REPLACEMENT?
(o=m.html(),r.html(o),r.attr("data-row",n),r.attr("data-col",v)):l.getDataReloadStrategy()===a.Constants.RELOAD_CELL_POSITION&&(m=m.removeClass("jMatrixBrowse-background-cell").addClass("jMatrixBrowse-cell").css({width:r.css("width"),height:r.css("height"),top:r.css("top"),left:r.css("left"),position:"absolute"}),r.hide(),m.show(),b.getCellElements()[o][p]=m)}}}}var o=this,b,l,m,B,v;this.reloadData=function(){var a=o.getCellWindow(b.currentCell);if(void 0==a)console.error("Unable to get cell window.");
else if((a=m.getResponse(a))&&a.data)for(var d=0;d<a.data.length;++d)for(var f=0;f<a.data[d].length;++f){var h=a.data[d][f];c(b.getCellElements()[d][f]).html(h)}};this.getPosition=function(){return b.currentCell};v=c("<div/>",{position:"absolute"}).appendTo(this);l=new a.Configuration(this);m="test"===l.getApiUrl()?new a.APIHandler("test"):new a.APIHandler("networked",l.getApiUrl());b=new a.jMatrixBrowseRenderer(v,l,m);v.bind("jMatrixBrowseRendererInitialized",function(){o.reloadData()});v.bind("jMatrixBrowseDrag",
function(){d();e()});v.bind("jMatrixBrowseAnimationStep",function(){d();e()});v.bind("jMatrixBrowseDragStop",function(){l.isSnapEnabled()&&!b.getIsAnimating()&&b.snapToGrid();d();e()});v.bind("jMatrixBrowseAnimationComplete",function(){l.isSnapEnabled()&&b.snapToGrid();d();e()});v.bind("jMatrixBrowseChange",function(a){a={currentCell:a.currentCell,previousCell:a.previousCell,direction:a.direction};if("top"===a.direction||"bottom"===a.direction){var d=m.getRowHeadersFromTopRow(a.currentCell.row-l.getNumberOfBackgroundCells());
b.getHeaders().row.children().each(function(b,a){b<d.length&&c(a).html(d[b])})}else{var f=m.getColHeadersFromLeftCol(a.currentCell.col-l.getNumberOfBackgroundCells());b.getHeaders().col.children().each(function(b,a){b<f.length&&c(a).html(f[b])})}if("top"===a.direction||"bottom"===a.direction){var e=h(a,a.direction);if(-1!==e){var j=n(a,"both");B.getCellsForRequest({row1:e.row1,row2:e.row2,col1:j.col1,col2:j.col2},function(b){p(e,j,b)})}}else{var g=n(a,a.direction);if(-1!==g){var i=h(a,"both");B.getCellsForRequest({row1:i.row1,
row2:i.row2,col1:g.col1,col2:g.col2},function(b){p(i,g,b)})}}});v.bind("jMatrixBrowseClick",function(b){console.log("click: "+b.row+", "+b.col)});c(document).bind("keydown","right",function(a){a.preventDefault();b.scrollRight()});c(document).bind("keydown","left",function(a){a.preventDefault();b.scrollLeft()});c(document).bind("keydown","up",function(a){a.preventDefault();b.scrollUp()});c(document).bind("keydown","down",function(a){a.preventDefault();b.scrollDown()});c(document).bind("keydown","j",
function(){b.scrollRight()});c(document).bind("keydown","h",function(){b.scrollLeft()});c(document).bind("keydown","k",function(){b.scrollUp()});c(document).bind("keydown","l",function(){b.scrollDown()});c(document).bind("keydown","ctrl+up",function(){b.pageUp()});c(document).bind("keydown","ctrl+down",function(){b.pageDown()});c(document).bind("keydown","ctrl+left",function(){b.pageLeft()});c(document).bind("keydown","ctrl+right",function(){b.pageRight()});c(document).bind("keydown","i",function(){console.log("zoom in");
b.zoomIn()});c(document).bind("keydown","o",function(){console.log("zoom out");b.zoomOut()});v.mousewheel(function(a){var c,d,e;a.ctrlKey?(c=b.pageLeft,d=b.pageRight,scrollDown=a.shiftKey?b.pageRight:b.pageDown,e=a.shiftKey?b.pageLeft:b.pageUp):(c=b.scrollLeft,d=b.scrollRight,scrollDown=a.shiftKey?b.scrollRight:b.scrollDown,e=a.shiftKey?b.scrollLeft:b.scrollUp);0<a.originalEvent.wheelDeltaX?c():0>a.originalEvent.wheelDeltaX&&d();0<a.originalEvent.wheelDeltaY?e():0>a.originalEvent.wheelDeltaY&&scrollDown()});
B=new a.BackgroundDataManager(v,m,l);return this}})(jQuery,jMatrixBrowseNs);function MatrixGenerator(c){function a(a){for(var c="",d=0;d<a;++d)c+=Math.random()>i?g[Math.floor(Math.random()*g.length)]:Math.floor(10*Math.random());return c}void 0==c&&(c="random");var i=0.5,g="ABCDEF".split(""),d,e,j;this.init=function(g,h){d=[];e=[];j=[];for(var i=0;i<g;++i){"random"==c?e.push(a(4*Math.random())):e.push("row "+i);d.push([]);for(var p=0;p<h;++p)"random"==c?(0==i&&j.push(a(4*Math.random())),d[i].push(a(4*Math.random()))):(0==i&&j.push("col "+p),d[i].push(i+", "+p))}};this.test_getMatrix=
function(){return d};this.test_getMatrixRowLabels=function(){return e};this.test_getMatrixColumnLabels=function(){return j}};function MockApi(c,a){var i=new MatrixGenerator("sequential");i.init(void 0==c?1E3:c,void 0==a?1E3:a);this.getResponse=function(a){for(var c=i.test_getMatrix(),e=i.test_getMatrixRowLabels(),j=i.test_getMatrixColumnLabels(),r=a.row1,h=a.row2,n=a.col1,a=a.col2,p={matrix:{height:c.length,width:c[0].length},row:{labels:[]},column:{labels:[]},data:[]},o=r;o<=h;++o){p.row.labels.push(e[o]);p.data.push([]);for(var b=n;b<=a;++b)o===r&&p.column.labels.push(j[b]),p.data[o-r].push(c[o][b])}return p};this.getResponseDataAsync=
function(a,c){var e=this.getResponse(a);c.call(this,e.data)};this.getResponseAsync=function(a,c){var e=this.getResponse(a);c.call(this,e)};this.getMatrixSize=function(){var a=this.getResponse({row1:0,col1:0,row2:0,col2:0});if(a)return a.matrix}};jMatrixBrowseNs=jMatrixBrowseNs||{};
jMatrixBrowseNs.Utils={parsePosition:function(c){c=c.split(",");if(2==c.length)return{row:parseInt(c[0]),col:parseInt(c[1])}},isOverflowing:function(c,a,i){var g=a.offset(),d=c.offset(),e=d.top-g.top,g=d.left-g.left,d=c.width(),c=c.height();switch(i){case jMatrixBrowseNs.Constants.OVERFLOW_LEFT:return 0>g+d;case jMatrixBrowseNs.Constants.OVERFLOW_RIGHT:return g>a.width();case jMatrixBrowseNs.Constants.OVERFLOW_TOP:return 0>e+c;case jMatrixBrowseNs.Constants.OVERFLOW_BOTTOM:return e>a.height()}return!1},
findIndexOfMin:function(c){if(c&&c.length){for(var a=c[0],i=0,g=1,d=c.length;g<d;++g)c[g]<a&&(a=c[g],i=g);return{min:a,minIndex:i}}return null}};jMatrixBrowseNs=jMatrixBrowseNs||{};
(function(c,a){a.NetworkedAPI=function(a){var g=this;c.ajax({url:a,dataType:"json",data:{row1:0,col1:0,row2:0,col2:0},async:!1,success:function(a){g.matrixSize=a.matrix}});this.getResponseAsync=function(d,e){c.getJSON(a,d,function(a){e.call(this,a)})};this.getResponseDataAsync=function(d,e){c.getJSON(a,d,function(a){e.call(this,a.data)})};this.getMatrixSize=function(){return this.matrixSize}};a.APIHandler=function(c,g){d="test"===c?new MockApi:new a.NetworkedAPI(g);this.getMatrixSize=function(){return d.getMatrixSize()};
this.getRowHeadersFromTopRow=function(a){for(var c=e.getCellElements().length,d=[],g=0;g<c;++g)d.push("row: "+(a+g));return d};this.getColHeadersFromLeftCol=function(a){for(var c=e.getCellElements()[0].length,d=[],g=0;g<c;++g)d.push("col: "+(a+g));return d};this.getRowDataForCell=function(c){var g=a.Constants.N_BACKGROUND_CELLS,h=[];if((c=d.getResponse({row1:c.row,col1:c.col-g,row2:c.row,col2:c.col-g+e.getCellElements()[0].length}))&&c.data&&1==c.data.length)for(g=0;g<c.data[0].length;++g)h.push(c.data[0][g]);
return h};this.getColDataForCell=function(c){var g=a.Constants.N_BACKGROUND_CELLS,h=[];if((c=d.getResponse({row1:c.row-g,col1:c.col,row2:c.row-g+e.getCellElements().length,col2:c.col}))&&c.data)for(g=0;g<c.data.length;++g)h.push(c.data[g][0]);return h};this.setRenderer=function(a){e=a};this.getResponse=function(a){return d.getResponse(a)};this.getResponseData=function(a){return d.getResponse(a).data};this.getResponseDataAsync=function(a,c){d.getResponseDataAsync(a,c)};var d,e;return this}})(jQuery,
jMatrixBrowseNs);
